@model NDHSITE.Models.HaiOrder
@{
    ViewBag.Title = "Detail";
}

<div class="page-header">
    <h3 class="page-title">Chi tiết đơn hàng</h3>

    <ol class="breadcrumb">
        <li><a href="/home">Trang chủ</a></li>
        <li><a href="#">Chi tiết đơn hàng</a></li>
    </ol>
</div> <!-- /.page-header -->

@if (Model.OrderStatus == "begin")
{
    <div class="row">
        <div class="col-sm-6">
            <form method="post" onsubmit="if(!confirm('Xác nhận đơn hàng?')){return false;}" action="/order/approve">
                <input type="hidden" value="@Model.Id" name="id" />
                <div class="form-group">
                    <label>Ghi chú</label>
                    <input type="text" name="notes" class="form-control" required />
                </div>
                <div class="form-group">
                    <label>Thao tác</label>
                    <select class="form-control" name="status">
                        <option value="1">Xác nhận đơn hàng</option>
                        <option value="0">Hủy đơn hàng</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Thực hiện</button>
            </form>
        </div>
    </div>
}
@if (Model.OrderStatus == "process")
{
    <div class="row">
        <div class="col-sm-6">
            <form method="post" onsubmit="if(!confirm('Kết thúc đơn hàng?')){return false;}" action="/order/finish">
                <input type="hidden" value="@Model.Id" name="id" />
                <div class="form-group">
                    <label>Ghi chú</label>
                    <input type="text" name="notes" class="form-control" required />
                </div>

                <button type="submit" class="btn btn-primary">Kết thúc đơn hàng</button>
            </form>
        </div>
    </div>
}
@if (Model.OrderStatus == "finish")
{
    <h4>Đơn hàng đã hoàn thành</h4>
}
@if (Model.OrderStatus == "cancel")
{
    <h4>Đơn hàng đã hủy</h4>
}
<br />
<hr />
<div class="row">
    <div class="col-sm-6">
        <div class="form-group">
            <label>Mã đơn hàng</label>
            <input type="text" value="@Model.Code" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Mã khách hàng</label>
            <input type="text" value="@Model.CInfoCommon.CCode" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Cửa hàng</label>
            <input type="text" value="@Model.CInfoCommon.CName" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Người đại diện</label>
            <input type="text" value="@Model.CInfoCommon.CDeputy" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Chi nhánh</label>
            <input type="text" value="@Model.CInfoCommon.BranchCode" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Địa chỉ giao hàng</label>
            <input type="text" value="@Model.ReceiveAddress" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Điện thoại liên hệ</label>
            <input type="text" value="@Model.ReceivePhone1" class="form-control" disabled />
        </div>

    </div>
    <div class="col-sm-6">
        <div class="form-group">
            <label>Tình trạng đơn hàng</label>
            <input type="text" value="@Model.OStatus.Name" class="form-control warning" disabled />
        </div>
        <div class="form-group">
            <label>Hình thức thành toán</label>
            <input type="text" value="@Model.PType.Name" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Phương thức giao hàng</label>
            <input type="text" value="@Model.SType.Name" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Ngày đặt hàng</label>
            <input type="text" value="@Model.CreateDate" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Ngày đề nghị giao</label>
            <input type="text" value="@Model.ExpectDate" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Tổng tiền</label>
            <input type="text" value="@(Model.PriceTotal != null?Model.PriceTotal.Value.ToString("C", NDHSITE.Util.Cultures.VietNam):"0")" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Ghi chú đặt hàng</label>
            <input type="text" value="@Model.Notes" class="form-control" disabled />
        </div>
        <div class="form-group">
            <label>Hình thức đặt hàng</label>
            <input type="text" value="@Model.OType.Name" class="form-control" disabled />
        </div>
    </div>
</div>


<br />
<br />
<ul id="myTab2" class="nav nav-pills">
    <li class="active">
        <a href="#home-2" data-toggle="tab">Đơn hàng</a>
    </li>
    <li>
        <a href="#profile-3" data-toggle="tab">Nhân viên thực hiện</a>
    </li>
</ul>

<div id="myTab2Content" class="tab-content">
    <div class="tab-pane fade in active" id="home-2">
        <fieldset>
            <table class="table table-striped table-bordered thumbnail-table">
                <thead>
                    <tr>
                        <th><strong>Sản phẩm</strong></th>
                        <th><strong>Số lượng</strong></th>
                        <th><strong>Giá tiền/đơn vị</strong></th>
                        <th><strong>Tổng tiền</strong></th>
                        <th><strong>Trạng thái</strong></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderProducts)
                    {
                        <tr>
                            <td><a href="/ShowInfo/ShowProduct?type=4&search=@item.ProductInfo.PCode" target="_blank">@item.ProductInfo.PName</a></td>
                            <td>@NDHSITE.Util.HaiUtil.ConvertProductQuantityText(item.ProductInfo.Quantity, item.Quantity, item.ProductInfo.Unit)</td>
                            <td> @(item.PerPrice != null ? item.PerPrice.Value.ToString("C", NDHSITE.Util.Cultures.VietNam) : "0")  / @item.ProductInfo.Unit</td>
                            <td>
                                @(item.PriceTotal != null ? item.PriceTotal.Value.ToString("C", NDHSITE.Util.Cultures.VietNam) : "0")
                            </td>
                            <td>
                                <span><strong>Cấp 1: </strong></span>@item.C1Info.Code <br />
                                <span><strong>Tên cấp 1: </strong></span>@item.C1Info.StoreName <br />
                                <span><strong>Số lượng giao: </strong></span>@NDHSITE.Util.HaiUtil.ConvertProductQuantityText(item.ProductInfo.Quantity, item.QuantityFinish, item.ProductInfo.Unit)<br />
                                @if (Model.OrderStatus == "begin")
                                {
                                    <a href="/order/modifyproduct?order=@item.OrderId&product=@item.ProductId" target="_blank">Thay đổi</a>
                                }
                                else if (Model.OrderStatus == "process")
                                {
                                    <a href="javascript:updateProduct('@item.ProductId','@item.OrderId', '@item.ProductInfo.PName')">Thay đổi</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </fieldset>
    </div>
    <div class="tab-pane fade" id="profile-3">
        <fieldset>
            <table class="table table-striped table-bordered thumbnail-table">
                <thead>
                    <tr>
                        <th><strong>Thao tác</strong></th>
                        <th><strong>Ngày thực hiện</strong></th>
                        <th><strong>Nhân viên</strong></th>
                        <th><strong>Đơn vị</strong></th>
                        <th>#</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.OrderStaffs)
                    {
                        <tr>
                            <td>@item.OrderStaffProcess.Name</td>
                            <td>@item.CreateTime</td>
                            <td>@item.HaiStaff.FullName - @item.HaiStaff.Code</td>
                            <td>@item.HaiStaff.HaiBranch.Code</td>
                            <td>@item.Notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </fieldset>
    </div>
</div>


<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Cập nhật giao hàng</h4>
            </div>
            <form method="post" action="/order/updatedelivery">
                <input type="hidden" name="orderId" id="orderId" />
                <input type="hidden" name="productId" id="productId" />
                <div class="modal-body">
                    <div class="form-group">
                        <label>Sản phẩm</label>
                        <input type="text" name="productName" class="form-control" id="productName" />
                    </div>
                    <div class="form-group">
                        <label>Số lượng thùng</label>
                        <input type="number" name="can" class="form-control"  value="0"/>
                    </div>
                    <div class="form-group">
                        <label>Số lượng lẻ</label>
                        <input type="number" name="box" class="form-control" value="0" />
                    </div>
                </div>
                

                <div class="modal-footer">
                    <button type="submit" class="btn btn-default" >Cập nhật</button>
                </div>
            </form>
          
        </div>

    </div>
</div>

@section scripts {
    
    <script type="text/javascript">
        function updateProduct(productId, orderId, pName) {
            console.log("da vao");
            $('#orderId').val(orderId);
            $('#productId').val(productId);
            $('#productName').val(pName);
            $('#myModal').modal('show');
        }
    </script>


}